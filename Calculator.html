<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lot Size Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .dark-mode {
            background-color: #1a202c;
            color: #edf2f7;
        }
        .dark-mode input,
        .dark-mode select {
            background-color: #2d3748;
            color: #edf2f7;
            border-color: #4a5568;
        }
        .dark-mode .bg-white {
            background-color: #2d3748;
        }
        .dark-mode .text-gray-500 {
            color: #a0aec0;
        }
    </style>
</head>
<body id="body" class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="absolute top-4 right-4">
        <button onclick="toggleDarkMode()" class="bg-gray-700 text-white px-3 py-1 rounded">Toggle Night Mode</button>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-lg w-96">
        <h2 class="text-xl font-bold text-center mb-4">Lot Size Calculator</h2>
        <!-- ... form remains unchanged ... -->

    </div>

    <script>
        function calculateLotSize() {
            let asset = document.getElementById("asset").value;
            let accountBalance = parseFloat(document.getElementById("accountBalance").value);
            let riskPercent = parseFloat(document.getElementById("riskPercent").value);
            let risk = parseFloat(document.getElementById("risk").value);
            let stopLoss = parseFloat(document.getElementById("stopLoss").value);
            let takeProfit = parseFloat(document.getElementById("takeProfit").value);

            if (!isNaN(accountBalance) && !isNaN(riskPercent)) {
                risk = (accountBalance * riskPercent) / 100;
                document.getElementById("risk").value = risk.toFixed(2);
            }

            if (isNaN(risk) || isNaN(stopLoss) || risk <= 0 || stopLoss <= 0) {
                alert("Please enter valid numbers for risk and stop loss distance.");
                return;
            }

            let perPointValue = {
                "EURUSD": 10, "GBPUSD": 10, "XAUUSD": 1, "USDCAD": 10, "EURJPY": 10,
                "NQ1": 20, "MNQ1": 2, "ES1": 50, "MES1": 5,
                "US100": 20, "US500": 50,
                "BTCUSDT": 1, "ETHUSDT": 1
            };

            let lotSize = risk / (stopLoss * perPointValue[asset]);
            document.getElementById("lotSize").innerText = lotSize.toFixed(2);

            let positionSize = lotSize * perPointValue[asset] * stopLoss;
            document.getElementById("positionSize").innerText = "$" + positionSize.toFixed(2);

            let rr = !isNaN(takeProfit) && takeProfit > 0 ? takeProfit / stopLoss : 0;
            document.getElementById("rr").innerText = rr.toFixed(2);

            updateUnit();
        }

        function updateUnit() {
            let asset = document.getElementById("asset").value;
            let unit = "lots";

            if (["NQ1", "MNQ1", "ES1", "MES1", "US100", "US500"].includes(asset)) {
                unit = "contracts";
            } else if (["BTCUSDT", "ETHUSDT"].includes(asset)) {
                unit = "coins";
            }

            document.getElementById("unit").innerText = unit;
        }

        function toggleDarkMode() {
            const body = document.body;
            const isDark = body.classList.toggle("dark-mode");
            localStorage.setItem("preferred-theme", isDark ? "dark" : "light");
        }

        // Match system theme by default and apply saved preference if it exists
        window.onload = function () {
            const saved = localStorage.getItem("preferred-theme");
            const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
            if (saved === "dark" || (!saved && prefersDark)) {
                document.body.classList.add("dark-mode");
            }
        };
    </script>
</body>
</html>
